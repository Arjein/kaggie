<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Save Button Validation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        input.valid { border-color: #10b981; background-color: #f0fdf4; }
        input.invalid { border-color: #ef4444; background-color: #fef2f2; }
        input.empty { border-color: #ddd; background-color: white; }
        
        .validation-message {
            font-size: 12px;
            margin: 5px 0;
            min-height: 16px;
        }
        .valid-msg { color: #10b981; }
        .invalid-msg { color: #ef4444; }
        
        .save-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin: 20px 0;
            transition: all 0.2s;
        }
        
        .save-button:hover:not(:disabled) { 
            background: #2563eb; 
        }
        
        .save-button:disabled { 
            background: #9ca3af; 
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.enabled { background: #d1fae5; color: #065f46; }
        .status.disabled { background: #fee2e2; color: #991b1b; }
        
        .test-scenario {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .test-button {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover { background: #7c3aed; }
        
        .icon {
            display: inline-block;
            margin-left: 10px;
            font-size: 16px;
        }
        
        .valid-icon { color: #10b981; }
        .invalid-icon { color: #ef4444; }
    </style>
</head>
<body>
    <h1>ðŸ”’ Save Button Validation Test</h1>
    <p>Test the new save button disable logic with proper API key validation. The save button should be disabled when:</p>
    <ul>
        <li>OpenAI API key is empty or invalid</li>
        <li>Tavily API key is provided but invalid (empty Tavily key is OK)</li>
    </ul>

    <div class="test-section">
        <h2>Interactive Validation Test</h2>
        <p>Type in the fields below to see the save button enable/disable logic in real-time:</p>
        
        <div class="input-group">
            <label>OpenAI API Key <span style="color: #ef4444;">*</span></label>
            <div style="position: relative;">
                <input 
                    type="text" 
                    id="openai-input" 
                    placeholder="sk-proj-..."
                    autocomplete="off"
                />
                <span id="openai-icon" class="icon"></span>
            </div>
            <div id="openai-validation" class="validation-message"></div>
        </div>
        
        <div class="input-group">
            <label>Tavily API Key <span style="color: #64748b;">(Optional)</span></label>
            <div style="position: relative;">
                <input 
                    type="text" 
                    id="tavily-input" 
                    placeholder="tvly-... (optional)"
                    autocomplete="off"
                />
                <span id="tavily-icon" class="icon"></span>
            </div>
            <div id="tavily-validation" class="validation-message"></div>
        </div>
        
        <button id="save-button" class="save-button" disabled onclick="simulateSave()">
            Save API Keys
        </button>
        
        <div id="button-status" class="status disabled">
            Save button is DISABLED - OpenAI API key is required
        </div>
        
        <div id="save-result"></div>
    </div>

    <div class="test-section">
        <h2>Automated Test Scenarios</h2>
        <p>Click these buttons to test different scenarios automatically:</p>
        
        <div class="test-scenario">
            <h3>Valid Scenarios (Button should be ENABLED)</h3>
            <button onclick="testScenario('sk-proj-1234567890abcdefghijklmnopqrstuvwxyz1234567890', '')" class="test-button">
                Valid OpenAI + Empty Tavily
            </button>
            <button onclick="testScenario('sk-1234567890abcdefghijklmnopqrstuvwxyz1234567890', '')" class="test-button">
                Valid OpenAI (sk-) + Empty Tavily
            </button>
            <button onclick="testScenario('sk-org-1234567890abcdefghijklmnopqrstuvwxyz1234567890', '')" class="test-button">
                Valid OpenAI (sk-org-) + Empty Tavily
            </button>
            <button onclick="testScenario('sk-proj-1234567890abcdefghijklmnopqrstuvwxyz1234567890', 'tvly-1234567890')" class="test-button">
                Valid OpenAI + Valid Tavily
            </button>
        </div>
        
        <div class="test-scenario">
            <h3>Invalid Scenarios (Button should be DISABLED)</h3>
            <button onclick="testScenario('', '')" class="test-button">
                Empty OpenAI + Empty Tavily
            </button>
            <button onclick="testScenario('sk-', '')" class="test-button">
                Short OpenAI + Empty Tavily
            </button>
            <button onclick="testScenario('invalid-key', '')" class="test-button">
                Invalid OpenAI + Empty Tavily
            </button>
            <button onclick="testScenario('sk-proj-1234567890abcdefghijklmnopqrstuvwxyz1234567890', 'tvly-')" class="test-button">
                Valid OpenAI + Short Tavily
            </button>
            <button onclick="testScenario('sk-proj-1234567890abcdefghijklmnopqrstuvwxyz1234567890', 'invalid-tavily')" class="test-button">
                Valid OpenAI + Invalid Tavily
            </button>
        </div>
    </div>

    <div class="test-section">
        <h2>Validation Logic Explanation</h2>
        <div style="background: #f1f5f9; padding: 15px; border-radius: 6px;">
            <h4>Save Button Enable Conditions:</h4>
            <code style="background: white; padding: 10px; display: block; border-radius: 4px; margin: 10px 0;">
                !isLoading && 
                openaiValidation.isValid && 
                openaiValidation.type !== 'empty' && 
                (tavilyApiKey.trim().length === 0 || tavilyValidation.isValid)
            </code>
            <p><strong>Translation:</strong> The save button is enabled when:</p>
            <ol>
                <li>Not currently saving</li>
                <li>OpenAI key is valid and not empty</li>
                <li>Either Tavily key is empty (optional) OR Tavily key is valid</li>
            </ol>
        </div>
    </div>

    <script>
        // Mock the validation functions from the utility
        function validateOpenAIApiKey(apiKey) {
            if (!apiKey || apiKey.trim().length === 0) {
                return {
                    isValid: false,
                    type: 'empty',
                    message: 'OpenAI API key is required'
                };
            }

            const trimmedKey = apiKey.trim();
            const validPrefixes = ['sk-', 'sk-proj-', 'sk-org-'];
            
            const hasValidPrefix = validPrefixes.some(prefix => trimmedKey.startsWith(prefix));
            if (!hasValidPrefix) {
                return {
                    isValid: false,
                    type: 'invalid',
                    message: 'OpenAI API key should start with "sk-", "sk-proj-", or "sk-org-"'
                };
            }

            if (trimmedKey.length < 20) {
                return {
                    isValid: false,
                    type: 'invalid',
                    message: 'OpenAI API key appears to be too short'
                };
            }

            const validCharacters = /^[a-zA-Z0-9\-_]+$/.test(trimmedKey);
            if (!validCharacters) {
                return {
                    isValid: false,
                    type: 'invalid',
                    message: 'OpenAI API key contains invalid characters'
                };
            }

            return {
                isValid: true,
                type: 'valid',
                message: 'OpenAI API key format looks valid'
            };
        }

        function validateTavilyApiKey(apiKey) {
            if (!apiKey || apiKey.trim().length === 0) {
                return {
                    isValid: true,
                    type: 'empty',
                    message: 'Tavily API key is optional'
                };
            }

            const trimmedKey = apiKey.trim();
            
            if (!trimmedKey.startsWith('tvly-')) {
                return {
                    isValid: false,
                    type: 'invalid',
                    message: 'Tavily API key should start with "tvly-"'
                };
            }

            if (trimmedKey.length < 10) {
                return {
                    isValid: false,
                    type: 'invalid',
                    message: 'Tavily API key appears to be too short'
                };
            }

            const validCharacters = /^[a-zA-Z0-9\-_]+$/.test(trimmedKey);
            if (!validCharacters) {
                return {
                    isValid: false,
                    type: 'invalid',
                    message: 'Tavily API key contains invalid characters'
                };
            }

            return {
                isValid: true,
                type: 'valid',
                message: 'Tavily API key format looks valid'
            };
        }

        function updateValidationUI(inputId, iconId, msgId, validation) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(iconId);
            const msg = document.getElementById(msgId);
            
            // Update input styling
            input.className = validation.type;
            
            // Update icon
            if (validation.type === 'valid') {
                icon.innerHTML = 'âœ“';
                icon.className = 'icon valid-icon';
            } else if (validation.type === 'invalid') {
                icon.innerHTML = 'âœ—';
                icon.className = 'icon invalid-icon';
            } else {
                icon.innerHTML = '';
                icon.className = 'icon';
            }
            
            // Update message
            if (validation.message && validation.type !== 'empty') {
                msg.textContent = validation.message;
                msg.className = `validation-message ${validation.type === 'valid' ? 'valid-msg' : 'invalid-msg'}`;
            } else {
                msg.textContent = validation.message || '';
                msg.className = 'validation-message';
            }
        }

        function updateSaveButton() {
            const openaiKey = document.getElementById('openai-input').value;
            const tavilyKey = document.getElementById('tavily-input').value;
            
            const openaiValidation = validateOpenAIApiKey(openaiKey);
            const tavilyValidation = validateTavilyApiKey(tavilyKey);
            
            const saveButton = document.getElementById('save-button');
            const statusDiv = document.getElementById('button-status');
            
            // Apply the same logic as in the actual components
            const isLoading = false; // Not loading in this test
            const canSave = !isLoading && 
                           openaiValidation.isValid && 
                           openaiValidation.type !== 'empty' && 
                           (tavilyKey.trim().length === 0 || tavilyValidation.isValid);
            
            saveButton.disabled = !canSave;
            
            if (canSave) {
                statusDiv.textContent = 'Save button is ENABLED - All validations passed';
                statusDiv.className = 'status enabled';
                saveButton.textContent = 'Save API Keys';
            } else {
                let reason = '';
                if (!openaiValidation.isValid || openaiValidation.type === 'empty') {
                    reason = 'OpenAI API key is required and must be valid';
                } else if (tavilyKey.trim().length > 0 && !tavilyValidation.isValid) {
                    reason = 'Tavily API key is invalid (either fix it or leave empty)';
                }
                
                statusDiv.textContent = `Save button is DISABLED - ${reason}`;
                statusDiv.className = 'status disabled';
                saveButton.textContent = 'Fix validation errors to save';
            }
        }

        function simulateSave() {
            const resultDiv = document.getElementById('save-result');
            resultDiv.innerHTML = `
                <div style="background: #d1fae5; color: #065f46; padding: 15px; border-radius: 6px; margin: 15px 0;">
                    âœ… API keys would be saved successfully! Agent would be reinitialized.
                </div>
            `;
            
            setTimeout(() => {
                resultDiv.innerHTML = '';
            }, 3000);
        }

        function testScenario(openaiKey, tavilyKey) {
            document.getElementById('openai-input').value = openaiKey;
            document.getElementById('tavily-input').value = tavilyKey;
            
            const openaiValidation = validateOpenAIApiKey(openaiKey);
            const tavilyValidation = validateTavilyApiKey(tavilyKey);
            
            updateValidationUI('openai-input', 'openai-icon', 'openai-validation', openaiValidation);
            updateValidationUI('tavily-input', 'tavily-icon', 'tavily-validation', tavilyValidation);
            updateSaveButton();
        }

        // Set up live validation
        document.getElementById('openai-input').addEventListener('input', function() {
            const validation = validateOpenAIApiKey(this.value);
            updateValidationUI('openai-input', 'openai-icon', 'openai-validation', validation);
            updateSaveButton();
        });

        document.getElementById('tavily-input').addEventListener('input', function() {
            const validation = validateTavilyApiKey(this.value);
            updateValidationUI('tavily-input', 'tavily-icon', 'tavily-validation', validation);
            updateSaveButton();
        });

        // Initialize
        updateSaveButton();
    </script>
</body>
</html>
